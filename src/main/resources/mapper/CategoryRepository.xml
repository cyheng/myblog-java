<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cyheng.repository.CategoryRepository">


    <sql id="selectCategory">
        SELECT
        C.id,
        C.category_name name,
        C.update_time,
        C.create_time
        FROM category C
    </sql>


    <select id="getArticles" resultMap="com.cyheng.repository.ArticleRepository.ArticleDetail">
        SELECT
            A.id,
            A.is_delete,
            A.content,
            A.`status`,
            A.title,
            A.summary,
            A.allow_comment,
            A.show_toc,
            A.create_time,
            A.update_time,
            C.id category_id,
        C.category_name
        FROM article A
            LEFT JOIN category C ON A.category_id = #{id}
        WHERE C.is_delete = 0
              AND A.is_delete = 0
    </select>
    <select id="findCategoryByName" resultType="com.cyheng.model.DO.Category">
        <include refid="selectCategory"/>
        WHERE C.is_delete = 0
        AND category_name = #{name}
    </select>
    <select id="getCategoryByPage" resultType="com.cyheng.model.DO.Category">
        <include refid="selectCategory"/>
        WHERE C.is_delete = 0
    </select>
    <select id="getArticleNum" resultType="java.lang.Integer">
        SELECT COUNT(A.id)
        FROM article A
        WHERE A.category_id = #{id}
              AND A.is_delete = 0
    </select>
    <select id="countCategory" resultType="java.lang.Integer">
        SELECT COUNT(C.id)
        FROM category C
        WHERE C.is_delete = 0
    </select>
</mapper>